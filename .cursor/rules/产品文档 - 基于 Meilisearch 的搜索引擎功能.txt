产品文档 - 基于 Meilisearch 的搜索引擎功能
1. 人工审核收录频道和群组
功能描述：
管理员可以手动选择需要收录的频道和群组，所有收录的内容会定时更新，并保证搜索引擎中的数据是最新的。

操作步骤：
登录后台管理系统，进入「收录管理」界面。
在「待审核频道和群组」列表中，管理员可以查看所有待审核的频道和群组。
点击「收录」按钮，将符合条件的频道和群组添加到搜索系统。
为每个已收录的频道和群组设置收录的时间间隔（如每日、每周）以确保数据更新。
配置选项：
审核周期：每日/每周/手动
审核状态：待审核/已收录/拒绝
批量审核：支持批量收录或拒绝操作
2. 实时收录发布内容（Bot 管理员权限）
功能描述：
当 Bot 拥有频道管理员权限时，系统会实时收录频道或群组中发布的新内容，保证用户在搜索时能够及时看到最新内容。

操作步骤：
确保 Bot 拥有频道或群组的管理员权限。
在 Bot 配置界面开启"实时收录"功能。
当新内容发布时，Bot 会自动收录该内容并提交给 Meilisearch 更新索引。
配置选项：
启用实时收录：开/关
收录延迟：实时/1小时/2小时等
3. 限制每个人每天的使用次数
功能描述：
为防止滥用，限制每个用户每天的搜索次数，管理员可以根据需要调整每日最大搜索次数。

操作步骤：
在后台的「用户管理」界面设置每个用户每天的最大搜索次数（例如：最多 10 次）。
系统会根据用户的使用记录自动限制超出次数的搜索请求。
管理员可以查看每日用户的搜索使用统计，调整限制。
配置选项：
每日搜索次数限制：设置最大次数
超出次数：提示用户"今日搜索次数已用完"
4. 指定 Topics 模式下的搜索权限
功能描述：
在 Topics 模式下，管理员可以指定特定小组的搜索权限，用户只能在该小组内搜索内容，避免其他小组内容被搜索到。

操作步骤：
进入「小组管理」界面，选择需要配置搜索权限的小组。
设置该小组的搜索权限为"仅限本小组"，限制跨小组搜索。
用户在该小组内进行搜索时，只会返回该小组的内容。
配置选项：
跨小组搜索：开/关
限制小组搜索：只在当前小组内搜索
5. 搜索功能与 Meilisearch 集成
功能描述：
基于 Meilisearch，提供快速、准确的全文搜索。支持模糊搜索、精确搜索，并根据内容的相关性调整搜索结果。

配置选项：
精确匹配：开/关
相关性排序：开启自动调整排序
搜索缓存：启用搜索缓存，提升搜索速度
6. 日志管理
功能描述：
记录 Bot 操作日志、收录日志、用户搜索日志等，方便管理员追溯和检查异常情况。

操作步骤：
在「日志管理」界面查看各类操作日志。
系统会自动记录每次收录、搜索、Bot 执行操作等，管理员可通过日志查看详细信息。
设置报警机制，在操作异常时及时通知管理员。
配置选项：
日志存储时长：可设置日志存储期限（如：30天）
日志类型：Bot 操作日志、收录日志、搜索日志
7. 高级搜索功能
功能描述：
提供多维度的搜索筛选选项，让用户能够更精确地找到所需内容。

操作步骤：
1. 在搜索界面提供"高级搜索"选项
2. 用户可以组合以下筛选条件：
   - 时间范围：今天/最近7天/最近30天/自定义时间段
   - 来源筛选：特定频道/群组
   - 内容类型：文本/图片/视频/文件
   - 发布者：特定用户
   - 互动数据：转发数/评论数/查看数范围
3. 支持保存搜索条件为预设，方便下次快速使用

配置选项：
- 高级搜索开关：开/关
- 默认搜索模式：简单/高级
- 最大保存预设数：10个

8. API 接口规范
功能描述：
提供标准化的 RESTful API 接口，支持第三方应用接入和功能扩展。

8.1 搜索相关接口
POST /api/v1/search
请求参数：
{
    "keyword": "搜索关键词",
    "filters": {
        "timeRange": {
            "start": "2024-03-01",
            "end": "2024-03-20"
        },
        "sources": ["channel_id1", "channel_id2"],
        "contentType": ["text", "image"],
        "publisher": "user_id",
        "interactions": {
            "minForwards": 10,
            "minComments": 5,
            "minViews": 100
        }
    },
    "pagination": {
        "page": 1,
        "size": 20
    },
    "sort": {
        "field": "timestamp",
        "order": "desc"
    }
}

8.2 内容管理接口
POST /api/v1/content
- 提交新内容到搜索引擎
PUT /api/v1/content/{id}
- 更新已存在的内容
DELETE /api/v1/content/{id}
- 删除指定内容

8.3 统计分析接口
GET /api/v1/stats/search
- 获取搜索统计数据
GET /api/v1/stats/content
- 获取内容统计数据

接口规范：
- 认证方式：Bearer Token
- 速率限制：每分钟 100 次请求
- 返回格式：统一 JSON 格式
- 错误处理：标准 HTTP 状态码 + 详细错误信息

开发文档 - 基于 Meilisearch 的搜索引擎实现
1. 架构设计
1.1 系统架构
本系统采用分布式架构，主要由以下组件构成：

Telegram Bot：负责与 Telegram 频道/群组交互，收录内容并提交给 Meilisearch。
Meilisearch：全文搜索引擎，负责对收录内容进行索引并提供搜索服务。
后台管理系统：管理员界面，提供收录管理、搜索设置和日志查看功能。
数据库：存储用户信息、频道群组信息、日志记录等。
1.2 数据流
内容收录：
用户发布新内容到群组/频道。
Bot 检测到新内容后，向 Meilisearch 提交该内容进行索引。
实时搜索：
用户在群组内发起搜索请求。
请求通过 Meilisearch 搜索引擎进行处理，返回相关结果。
用户权限：
系统根据配置限制用户的搜索次数，超出限制时阻止搜索。
根据 Topics 模式配置，限制用户只能在指定小组内搜索内容。
2. Bot 开发
2.1 功能概述
Bot 主要负责以下功能：

监听并收录频道或群组中的新内容。
与 Meilisearch 交互，提交新内容和更新内容。
根据管理员设置的权限限制，执行用户的搜索请求。
2.2 关键接口
收录接口：
/collect：接收新内容并提交给 Meilisearch。
数据格式：JSON（包括内容、来源频道、发布时间等信息）
搜索接口：
/search：接收用户的搜索请求并返回 Meilisearch 搜索结果。
数据格式：JSON（包括关键词、用户信息、搜索限制等）
2.3 安全性
Bot 必须使用最小权限原则，确保其只能访问和操作必要的信息。
所有操作和用户请求的日志会记录到数据库，以便管理员后续审计。
3. Meilisearch 集成
3.1 搜索引擎配置
使用 Meilisearch API 提供全文索引服务，配置索引字段包括内容、时间、来源频道、话题标签等。
自动更新：每当 Bot 收录新内容或更新内容时，自动调用 Meilisearch API 更新索引。

// 添加高级搜索配置
searchableAttributes: [
    'content',
    'title',
    'publisher',
    'channel_name',
    'content_type'
],
filterableAttributes: [
    'timestamp',
    'channel_id',
    'content_type',
    'publisher_id',
    'forward_count',
    'comment_count',
    'view_count'
],
sortableAttributes: [
    'timestamp',
    'forward_count',
    'comment_count',
    'view_count'
]

3.2 搜索优化
模糊搜索：启用 Meilisearch 的模糊搜索功能，支持用户输入部分关键词。
排序：根据内容的相关性、发布时间等因素排序搜索结果，提升用户体验。
4. 数据库设计
4.1 用户表
字段：
user_id：用户唯一标识
email：绑定邮箱
search_count：今日搜索次数
membership：用户权限级别（如普通、VIP）
join_date：加入时间
4.2 收录日志表
字段：
log_id：日志ID
channel_id：频道或群组ID
content：收录的内容摘要
timestamp：收录时间
status：收录状态（成功/失败）
4.3 搜索日志表
字段：
log_id：日志ID
user_id：用户ID
query：搜索查询内容
timestamp：搜索时间
result_count：返回的结果数量
5. 性能优化
缓存机制：为热门查询或频繁搜索的内容启用缓存，减少对 Meilisearch 的请求频率。
增量更新：在内容更新时，仅提交更新的部分而不是全量内容，降低负载。
分布式部署：Meilisearch 和数据库采用分布式部署，确保系统在高并发情况下稳定运行。
6. 数据备份与恢复
功能描述：
定期备份搜索索引和关键数据,确保系统可以从故障中快速恢复。

操作步骤：
1. 自动备份
- 每日对 Meilisearch 索引进行快照备份
- 定期备份数据库
- 备份文件异地存储

2. 恢复机制
- 提供一键恢复功能
- 支持选择恢复时间点
- 恢复过程的进度展示

7. 系统监控
功能描述：
实时监控系统各项指标,发现异常及时告警。

监控指标：
- 搜索响应时间
- 索引更新延迟
- 系统资源使用率
- 错误率统计

告警方式：
- 邮件通知
- Telegram Bot 消息
- 短信通知(重要事件)

8. 内容审核
功能描述：
对收录的内容进行自动审核,过滤违规内容。

实现方式：
- 接入第三方内容审核服务
- 关键词过滤
- AI 模型识别
- 用户举报机制

审核流程：
1. 内容收录时自动审核
2. 定期对存量内容进行扫描
3. 对违规内容自动下架
4. 保留审核记录,支持人工复核